<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<title>Unblu visitor single sign-on (SSO)</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge, pre.rouge .w {
  color: #24292f;
  background-color: #f6f8fa;
}
pre.rouge .k, pre.rouge .kd, pre.rouge .kn, pre.rouge .kp, pre.rouge .kr, pre.rouge .kt, pre.rouge .kv {
  color: #cf222e;
}
pre.rouge .gr {
  color: #f6f8fa;
}
pre.rouge .gd {
  color: #82071e;
  background-color: #ffebe9;
}
pre.rouge .nb {
  color: #953800;
}
pre.rouge .nc {
  color: #953800;
}
pre.rouge .no {
  color: #953800;
}
pre.rouge .nn {
  color: #953800;
}
pre.rouge .sr {
  color: #116329;
}
pre.rouge .na {
  color: #116329;
}
pre.rouge .nt {
  color: #116329;
}
pre.rouge .gi {
  color: #116329;
  background-color: #dafbe1;
}
pre.rouge .kc {
  color: #0550ae;
}
pre.rouge .l, pre.rouge .ld, pre.rouge .m, pre.rouge .mb, pre.rouge .mf, pre.rouge .mh, pre.rouge .mi, pre.rouge .il, pre.rouge .mo, pre.rouge .mx {
  color: #0550ae;
}
pre.rouge .sb {
  color: #0550ae;
}
pre.rouge .bp {
  color: #0550ae;
}
pre.rouge .ne {
  color: #0550ae;
}
pre.rouge .nl {
  color: #0550ae;
}
pre.rouge .py {
  color: #0550ae;
}
pre.rouge .nv, pre.rouge .vc, pre.rouge .vg, pre.rouge .vi, pre.rouge .vm {
  color: #0550ae;
}
pre.rouge .o, pre.rouge .ow {
  color: #0550ae;
}
pre.rouge .gh {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .gu {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .s, pre.rouge .sa, pre.rouge .sc, pre.rouge .dl, pre.rouge .sd, pre.rouge .s2, pre.rouge .se, pre.rouge .sh, pre.rouge .sx, pre.rouge .s1, pre.rouge .ss {
  color: #0a3069;
}
pre.rouge .nd {
  color: #8250df;
}
pre.rouge .nf, pre.rouge .fm {
  color: #8250df;
}
pre.rouge .err {
  color: #f6f8fa;
  background-color: #82071e;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cm, pre.rouge .cp, pre.rouge .cpf, pre.rouge .c1, pre.rouge .cs {
  color: #6e7781;
}
pre.rouge .gl {
  color: #6e7781;
}
pre.rouge .gt {
  color: #6e7781;
}
pre.rouge .ni {
  color: #24292f;
}
pre.rouge .si {
  color: #24292f;
}
pre.rouge .ge {
  color: #24292f;
  font-style: italic;
}
pre.rouge .gs {
  color: #24292f;
  font-weight: bold;
}
</style>
</head>
<body class="article">
<div id="header">
<h1>Unblu visitor single sign-on (SSO)</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_data_flow">Data flow</a></li>
<li><a href="#_configuring_unblu_for_visitor_ss0">Configuring Unblu for visitor SS0</a></li>
<li><a href="#_generating_an_rsa_key_pair_to_encrypt_the_jwt">Generating an RSA key pair to encrypt the JWT</a></li>
<li><a href="#_generating_a_jwt">Generating a JWT</a></li>
<li><a href="#_starting_an_unblu_authentication_session_using_a_jwt">Starting an Unblu authentication session using a JWT</a></li>
<li><a href="#_ending_an_unblu_session">Ending an Unblu session</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This tutorial is intended as a guide for developers implementing Unblu&#8217;s visitor SSO using JSON Web Tokens (JWT) in an application.</p>
</div>
<div class="paragraph">
<p>Adding visitor SSO to your application has a number of benefits:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Agents know who they are speaking to.</p>
</li>
<li>
<p>Visitors can view their old conversations from different devices.</p>
</li>
<li>
<p>Different people using the same device each has their own conversation history.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Before you continue, you may want to review the general introduction to Unblu Cloud SSO in our official <a href="https://www.unblu.com/en/docs/latest/knowledge-base/cloud-sso.html">documentation</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Logging in to Unblu using a JWT was introduced in Unblu 6.13.0.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_data_flow">Data flow</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The diagram below illustrates the order in which data flows between a visitor, your application, and the Unblu server during visitor SSO.</p>
</div>
<div class="imageblock">
<div class="content">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="-0.5 -0.5 813 553" content="&lt;mxfile host=&quot;Electron&quot; modified=&quot;2021-06-04T08:56:59.615Z&quot; agent=&quot;5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/14.6.13 Chrome/89.0.4389.128 Electron/12.0.7 Safari/537.36&quot; etag=&quot;oP5y3UmSI7kw2NYmpbMT&quot; version=&quot;14.6.13&quot; type=&quot;device&quot;&gt;&lt;diagram id=&quot;WSgzDGeLXuhfTpE6_wTB&quot; name=&quot;Page-1&quot;&gt;7Vttd6I4FP41fqyHEIjwUa3O7pzOnp7p7LzsN8SoaSNhIbQ6v34TCGAI1dZB2zOrPaeSmxCSe5/n3ssFe3C83nxIgnj1ic0x7dnWfNOD1z3bBpbniy8p2RYS3/YKwTIhczWoFtyRn7g8U0kzMsepNpAzRjmJdWHIogiHXJMFScKe9GELRvWrxsESG4K7MKCm9BuZ85WSAuTXHX9gslypS3v2oOhYB+VgtZN0FczZ044ITnpwnDDGi6P1ZoypVF6pl+K86TO91cISHPGXnJBBCqPvX8LN+pPvWg/kFmz+unKLWR4DmqkNq8XybamBhGXRHMtJQA+OnlaE47s4CGXvk7C5kK34mqrulCfsodIUFJIFoXTMKEvy2eA0/1Qjd3rcsTtFQ9ETJKHCgdDRyNym2vkjTjje7IjUtj9gtsY82YohqtdVtlIQdJRBnmp7eiXcVjumdF0lDBSGltXMtZrFgdL0K7QOzq31CZJ/e7XegZ6BZ2mKRi2KbtEzgB3oGTP3A/i8pevr+398f3L/8WcEWvT8g2WJXBGe9WxExQJGs0RTPPo3k4QcLVjEr9IchkMxADjxpu4UR0v5HcQxJWHACYt+zYDyatNgTajU3OdsRh6U8E6sNz9nxbnweLYrV+MKpch/ckDaXzK2pDiISdoP2TrvCNN86HRRTCkO9UkLdgFHtdvo2QDQ0B87k1EbgAaTIZpYrSDsAlJIhxT0TUwBuwVU6FSYsg1MfSUp4UIdTQQIhx/Lw2xNh6EcAEdy4wIw9CaYYXrLxHkSOvB6xjgXtqsHDClZyg7OGkhhGackEgYow531pvAx/UnoLlBgAquS6zDpyMPblg4Tz0SJ0wKSwalAAg2QTCKOk12fU3iQMMFzsW0S0NTAD47mQ5nBSHxQFj58WZHonbqNPdYVuyhPVM0poeUGxNaT7XeJ4j6EZfuHQnXeuN5ore1u6xYnRNgLJ0p4RHDjQbLE/HAIwXMtTXwWiFdW3/I9WwPjVYvPctvyDSVLMBUh5VFPQNsgqlZxy4jY1bNcAH4D5WkODnXWbsLYmAj4et4Emz61UN6eicqBbLFIsTYmZ1WlvuOJ5hhE+4x5lkQm0z5++/J/ZNgRnHgp1q0+0HHugbPiHDbgeSzOmxMZhHkHODfv0/6OZjT7zbPO6XQEETJAD9twPR650LI6umFsuNC2pLMN2SfLJ5Bh/jtBcyH5vbxam5t6bUaxIbxIKET0Kpp5PtF3bFe165RCNrY7jWZCUaUnMqxbSEtQ+tCtMpbXJCnPwjMtdd/bXzU4mLK4r05ZgINcDfA2OqsnR7bQpl9/dHcMHGFLq/405n+pm2+SGoBBZ25e8C3Y7oyI5RnpKQLBoMUTyLWlOE3zMoT157WcQx6FjD0QfPEPrf5Bcw6D/b7hl1MlwTHbQY6erzjn5JiBfugemS2h5kSo35jqJERqXw30nltNzbtizk5ZCMwq0A0LZECOsxkloTh4wNsL81rv9YEeR91DUbSK6O4OZ8Fewkpe3im9s4Sv2JJFAZ3U0peF4X3htevKgchQfFePwvCsdQPkNKjkHXk/BRuuxrHf3/0UMCt04wQHHMur55l1KguwKsG2zHJClpJoKRGUkMfitAvhR2GWPFY3nzr7uwihFrI8DVlXzlkrDs3nW07zAeGxMdSY6CBDSqXYUOcs0uf59QBbPYhXV3D1p8wnCq9mWe9rQMm8INpBSl5C8NkYCYAOwKvBeWOW24hZzpGMNCYCRzLS1fWBvK4JOYDNjPcchDTrj2W6tEMtSkmc4sN1xyCNi2eXC7KR4HwjynlmwXEAZzOM9hQodSpGLNqbS77iOXcDf23vTrQ9wWzivbtXJ8ySI7xYvEOL2+/O4mZpyb5YvEuLN+6LqpLMm1ncMyzuXCzepcWbL8T5b2xw3zD44GLwExq8CutvZfFqC7XF0cXiHVp8YDXuwC33jS1ulqbdi8U7tDi0dY47LWXaU1m89blwS5Z2sPxdvyciy+X1mBsmXzjNTX+POd8qAwQZZzowjqrKt9deDrywdPjFjoMl+zLuHa7Zq4EHSyAvrls8Y1nRrH/5Udyl17+fgZP/AA==&lt;/diagram&gt;&lt;/mxfile&gt;" width="Embedded"><defs/><g><rect x="1" y="1" width="810" height="550" rx="11" ry="11" fill="#ffffff" stroke="#5c5f6a" stroke-width="3" pointer-events="all"/><rect x="122" y="21" width="80" height="130" rx="12" ry="12" fill="#e6e6e6" stroke="#5c5f6a" stroke-width="3" pointer-events="all"/><rect x="102" y="351" width="120" height="60" rx="9" ry="9" fill="#a9c4eb" stroke="#7ea6e0" stroke-width="3" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 381px; margin-left: 103px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 14px; font-family: Rubik; color: #FFFFFF; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">Your web<br style="font-size: 14px" />application</div></div></div></foreignObject><text x="162" y="385" fill="#FFFFFF" font-family="Rubik" font-size="14px" text-anchor="middle">Your web...</text></switch></g><ellipse cx="162" cy="49.75" rx="10" ry="8.75" fill="#ffffff" stroke="#5c5f6a" stroke-width="2" pointer-events="all"/><path d="M 162 58.5 L 162 87.67 M 162 64.33 L 142 64.33 M 162 64.33 L 182 64.33 M 162 87.67 L 142 111 M 162 87.67 L 182 111" fill="none" stroke="#5c5f6a" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 118px; margin-left: 162px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 14px; font-family: Rubik; color: #5c5f6a; line-height: 1.2; pointer-events: all; white-space: nowrap; ">Visitor</div></div></div></foreignObject><text x="162" y="132" fill="#5c5f6a" font-family="Rubik" font-size="14px" text-anchor="middle">Visitor</text></switch></g><path d="M 142 151 L 141.63 334.76" fill="none" stroke="#5c5f6a" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 141.6 348.76 L 136.97 334.75 L 146.3 334.77 Z" fill="#5c5f6a" stroke="#5c5f6a" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 241px; margin-left: 52px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 14px; font-family: Rubik; color: #5c5f6a; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">Enter<br />credentials</div></div></div></foreignObject><text x="52" y="245" fill="#5c5f6a" font-family="Rubik" font-size="14px" text-anchor="middle">Enter...</text></switch></g><path d="M 181 351 L 181 167.24" fill="none" stroke="#5c5f6a" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 181 153.24 L 185.67 167.24 L 176.33 167.24 Z" fill="#5c5f6a" stroke="#5c5f6a" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 241px; margin-left: 262px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 14px; font-family: Rubik; color: #5c5f6a; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">Return<br />JWT</div></div></div></foreignObject><text x="262" y="245" fill="#5c5f6a" font-family="Rubik" font-size="14px" text-anchor="middle">Return...</text></switch></g><rect x="442" y="51" width="150" height="70" rx="10.5" ry="10.5" fill="#ffb366" stroke="#cb5300" stroke-width="3" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 148px; height: 1px; padding-top: 86px; margin-left: 443px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 14px; font-family: Rubik; color: #FFFFFF; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">Unblu</div></div></div></foreignObject><text x="517" y="90" fill="#FFFFFF" font-family="Rubik" font-size="14px" text-anchor="middle">Unblu</text></switch></g><path d="M 201.2 76.25 L 424.86 75.75" fill="none" stroke="#5c5f6a" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 438.86 75.72 L 424.87 80.41 L 424.85 71.08 Z" fill="#5c5f6a" stroke="#5c5f6a" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 50px; margin-left: 303px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 14px; font-family: Rubik; color: #5c5f6a; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">Send JWT</div></div></div></foreignObject><text x="303" y="54" fill="#5c5f6a" font-family="Rubik" font-size="14px" text-anchor="middle">Send JWT</text></switch></g><path d="M 442 96 L 332 97.38 Q 322 97.5 312 97.5 L 218.24 97.5" fill="none" stroke="#5c5f6a" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 204.24 97.5 L 218.24 92.83 L 218.24 102.17 Z" fill="#5c5f6a" stroke="#5c5f6a" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 131px; margin-left: 352px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 14px; font-family: Rubik; color: #5c5f6a; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">Set session ID in cookie</div></div></div></foreignObject><text x="352" y="135" fill="#5c5f6a" font-family="Rubik" font-size="14px" text-anchor="middle">Set sess...</text></switch></g><path d="M 517 121 L 517 371 Q 517 381 507 381 L 238.24 381" fill="none" stroke="#5c5f6a" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 224.24 381 L 238.24 376.33 L 238.24 385.67 Z" fill="#5c5f6a" stroke="#5c5f6a" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 411px; margin-left: 362px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 14px; font-family: Rubik; color: #5c5f6a; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">Load public key</div></div></div></foreignObject><text x="362" y="415" fill="#5c5f6a" font-family="Rubik" font-size="14px" text-anchor="middle">Load pub...</text></switch></g><path d="M 122 411 Q 152 481 192.56 424.21" fill="none" stroke="#5c5f6a" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 200.7 412.82 L 196.36 426.92 L 188.77 421.5 Z" fill="#5c5f6a" stroke="#5c5f6a" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 521px; margin-left: 162px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 14px; font-family: Rubik; color: #5c5f6a; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">Create and sign JWT <br />using private key</div></div></div></foreignObject><text x="162" y="525" fill="#5c5f6a" font-family="Rubik" font-size="14px" text-anchor="middle">Create a...</text></switch></g><path d="M 592 101 Q 672 91 607.75 74.94" fill="none" stroke="#5c5f6a" stroke-width="2" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 594.17 71.54 L 608.88 70.41 L 606.62 79.47 Z" fill="#5c5f6a" stroke="#5c5f6a" stroke-width="2" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 91px; margin-left: 742px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 14px; font-family: Rubik; color: #5c5f6a; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">Validate JWT <br />using public key</div></div></div></foreignObject><text x="742" y="95" fill="#5c5f6a" font-family="Rubik" font-size="14px" text-anchor="middle">Validate...</text></switch></g><ellipse cx="112" cy="241" rx="20" ry="20" fill="#73bbe6" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 38px; height: 1px; padding-top: 241px; margin-left: 93px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 18px; font-family: Rubik; color: #FFFFFF; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">1</div></div></div></foreignObject><text x="112" y="246" fill="#FFFFFF" font-family="Rubik" font-size="18px" text-anchor="middle">1</text></switch></g><ellipse cx="212" cy="241" rx="20" ry="20" fill="#73bbe6" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 38px; height: 1px; padding-top: 241px; margin-left: 193px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 18px; font-family: Rubik; color: #FFFFFF; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">3</div></div></div></foreignObject><text x="212" y="246" fill="#FFFFFF" font-family="Rubik" font-size="18px" text-anchor="middle">3</text></switch></g><ellipse cx="162" cy="481" rx="20" ry="20" fill="#73bbe6" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 38px; height: 1px; padding-top: 481px; margin-left: 143px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 18px; font-family: Rubik; color: #FFFFFF; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">2</div></div></div></foreignObject><text x="162" y="486" fill="#FFFFFF" font-family="Rubik" font-size="18px" text-anchor="middle">2</text></switch></g><ellipse cx="242" cy="50" rx="20" ry="20" fill="#73bbe6" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 38px; height: 1px; padding-top: 50px; margin-left: 223px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 18px; font-family: Rubik; color: #FFFFFF; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">4</div></div></div></foreignObject><text x="242" y="55" fill="#FFFFFF" font-family="Rubik" font-size="18px" text-anchor="middle">4</text></switch></g><ellipse cx="242" cy="131" rx="20" ry="20" fill="#73bbe6" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 38px; height: 1px; padding-top: 131px; margin-left: 223px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 18px; font-family: Rubik; color: #FFFFFF; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">7</div></div></div></foreignObject><text x="242" y="136" fill="#FFFFFF" font-family="Rubik" font-size="18px" text-anchor="middle">7</text></switch></g><ellipse cx="665" cy="86" rx="20" ry="20" fill="#73bbe6" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 38px; height: 1px; padding-top: 86px; margin-left: 646px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 18px; font-family: Rubik; color: #FFFFFF; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">6</div></div></div></foreignObject><text x="665" y="91" fill="#FFFFFF" font-family="Rubik" font-size="18px" text-anchor="middle">6</text></switch></g><ellipse cx="282" cy="411" rx="20" ry="20" fill="#73bbe6" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 38px; height: 1px; padding-top: 411px; margin-left: 263px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 18px; font-family: Rubik; color: #FFFFFF; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">5</div></div></div></foreignObject><text x="282" y="416" fill="#FFFFFF" font-family="Rubik" font-size="18px" text-anchor="middle">5</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://www.diagrams.net/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Viewer does not support full SVG 1.1</text></a></switch></svg>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The visitor is authenticated using your application&#8217;s standard authentication mechanism.</p>
</li>
<li>
<p>The application creates a JWT and signs it with a private key.</p>
</li>
<li>
<p>The application sends the JWT to the visitor&#8217;s browser.</p>
</li>
<li>
<p>The visitor&#8217;s browser sends the JWT to Unblu (<code>POST /unblu/rest/v3/authenticator/loginWithSecureToken</code>)</p>
</li>
<li>
<p>Unblu loads the public key used to sign the JWT from the application.
Unblu will cache the keys and therefore not request it for every validation.</p>
</li>
<li>
<p>Unblu validates the JWT signature and attributes (<code>iss</code>, <code>aud</code>, <code>exp</code>).</p>
</li>
<li>
<p>Unblu sets a session cookie in the visitor&#8217;s browser.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The Unblu backend and the host application must be running in the same second-level domain (e.g. <code>example.com</code>).
If they don&#8217;t, some browsers&#8201;&#8212;&#8201;Safari, for example&#8201;&#8212;&#8201;will treat the Unblu authentication cookie as a third-party cookie and block it.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_unblu_for_visitor_ss0">Configuring Unblu for visitor SS0</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, visitor SSO is disabled.
Use the configuration below to activate it.</p>
</div>
<div class="listingblock">
<div class="title">Visitor SSO Configuration in Unblu</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ini"><span class="c"># Ensure that /unblu (visitor) and /co-unblu (agent) are separated
# and authentication cookies are set on the correct path
</span><span class="py">com.unblu.identifier.publicPathPrefix</span><span class="p">=</span><span class="s">${systemIdentifier}</span>
<span class="py">com.unblu.identifier.restrictedPathPrefix</span><span class="p">=</span><span class="s">co-${systemIdentifier}</span>

<span class="c"># Visitor SSO is typically used in a cross-site setup, so we disable
# site-embedded mode
</span><span class="py">com.unblu.identifier.siteEmbeddedSetup</span><span class="p">=</span><span class="s">false</span>

<span class="py">com.unblu.authentication.untrusted.sources</span><span class="p">=</span><span class="s">LOCAL</span>

<span class="py">com.unblu.authentication.jwt.jwkUrl</span><span class="p">=</span><span class="s">https://application.example.com/api/jwk</span>
<span class="py">com.unblu.authentication.jwt.expectedIssuer</span><span class="p">=</span><span class="s">https://application.example.com</span>
<span class="py">com.unblu.authentication.jwt.expectedAudience</span><span class="p">=</span><span class="s">https://example.unblu.cloud</span>
<span class="py">com.unblu.authentication.jwt.useEncryption</span><span class="p">=</span><span class="s">false</span>
<span class="c">#com.unblu.authentication.jwt.encryptionKey=&lt;private key, if encryption is enabled&gt;
</span>
<span class="c"># Enable authenticator/loginWithSecureToken
</span><span class="py">com.unblu.authentication.tokenSignup.enabled</span><span class="p">=</span><span class="s">true</span>
<span class="py">com.unblu.authentication.tokenSignup.claimMapping.username</span><span class="p">=</span><span class="s">username</span>
<span class="py">com.unblu.authentication.tokenSignup.claimMapping.email</span><span class="p">=</span><span class="s">email</span>
<span class="py">com.unblu.authentication.tokenSignup.claimMapping.firstName</span><span class="p">=</span><span class="s">firstName</span>
<span class="py">com.unblu.authentication.tokenSignup.claimMapping.lastName</span><span class="p">=</span><span class="s">lastName</span>

<span class="c"># To use cross-site cookies, most browsers require that you use HTTPS.
# Enable the configuration properties below if you run the application without
# a reverse proxy providing HTTPS connections.
#com.unblu.identifier.cookieSecureFlag=true
#com.unblu.runtime.jetty.securehttpenabled=true
#com.unblu.runtime.jetty.keystorepath=tls.p12
</span><span class="err">#</span><span class="py">com.unblu.runtime.jetty.keystorepassword</span><span class="p">=</span><span class="s">password</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The URL configured in the <code>jwkUrl</code> property must be accessible from the Unblu server.
<code>expectedIssuer</code> and <code>expectedAudience</code> must match the <code>iss</code> and <code>aud</code> claims as set by the application.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_generating_an_rsa_key_pair_to_encrypt_the_jwt">Generating an RSA key pair to encrypt the JWT</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can encrypt the JWT.
This will hide the content of the JWT payload from the visitor if they intercept the request in their browser.</p>
</div>
<div class="paragraph">
<p>To use JWT encryption, generate an RSA key pair.
Encryption uses a separate key pair, and the application uses Unblu&#8217;s public key to encrypt the JWT after signing it with its own private key.</p>
</div>
<div class="paragraph">
<p>The snippet belows shows how to generate an RSA key pair using <code>openssl</code>.</p>
</div>
<div class="listingblock">
<div class="title">Generate RSA key pair</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">openssl genpkey <span class="nt">-algorithm</span> RSA <span class="nt">-out</span> unblu.pem <span class="nt">-pkeyopt</span> rsa_keygen_bits:2048
openssl rsa <span class="nt">-pubout</span> <span class="nt">-in</span> unblu.pem <span class="nt">-out</span> unblu_public.pem</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_generating_a_jwt">Generating a JWT</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The code samples that follow are part of a <a href="https://github.com/unblu/unblu-visitor-sso-sample">sample implementation</a> of visitor SSO and may be freely copied.</p>
</div>
<div class="paragraph">
<p>The application needs to create a JWT signed with an RSA key pair and make it accessible from the browser JavaScript after the user authenticated with his application specific credentials.</p>
</div>
<div class="paragraph">
<p>The JWT must be signed with a key pair referenced by its Key ID (<code>kid</code>).
It must include the user attributes as claims.
The claims must be named as configured in the <a href="https://www.unblu.com/en/docs/latest/reference/configuration-properties.html#com-unblu-platform-server-core-auth-configuration-claimmappingconfiguration" target="_blank" rel="noopener"><code>claimMapping</code></a> in the Unblu configuration.</p>
</div>
<div class="listingblock">
<div class="title">Decoded sample JWT</div>
<div class="content">
<pre class="rouge highlight"><code>Token header
------------
{
"typ": "JWT",
"alg": "RS256",
"kid": "5d2acf7b-b5e3-4a08-8e71-0953f8cdf1f6"
}

Token claims
------------
{
"aud": "https://example.unblu.cloud",
"email": "peter.muster@example.com",
"exp": 1622640746,
"firstName": "Peter",
"iat": 1622637146,
"iss": "https://application.example.com",
"lastName": "Muster",
"username": "pmuster"
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You can check a JWT with a service such as <a href="https://jwt.io/">jwt.io</a>.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Create a JWT in Kotlin using the <a href="https://connect2id.com/products/nimbus-jose-jwt">Nimbus</a> library</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="kd">val</span> <span class="py">header</span> <span class="p">=</span> <span class="nc">JWSHeader</span><span class="p">.</span><span class="nc">Builder</span><span class="p">(</span><span class="nc">JWSAlgorithm</span><span class="p">.</span><span class="nc">RS256</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">type</span><span class="p">(</span><span class="nc">JOSEObjectType</span><span class="p">.</span><span class="nc">JWT</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">keyID</span><span class="p">(</span><span class="n">key</span><span class="p">.</span><span class="n">keyID</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">build</span><span class="p">()</span>
<span class="kd">val</span> <span class="py">expiration</span> <span class="p">=</span> <span class="nc">Date</span><span class="p">(</span><span class="nc">System</span><span class="p">.</span><span class="nf">currentTimeMillis</span><span class="p">()</span> <span class="p">+</span> <span class="n">configuration</span><span class="p">.</span><span class="n">validFor</span><span class="p">.</span><span class="nf">toMillis</span><span class="p">())</span>
<span class="kd">val</span> <span class="py">payload</span> <span class="p">=</span> <span class="nc">JWTClaimsSet</span><span class="p">.</span><span class="nc">Builder</span><span class="p">()</span>
    <span class="p">.</span><span class="nf">issuer</span><span class="p">(</span><span class="n">configuration</span><span class="p">.</span><span class="n">issuer</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">audience</span><span class="p">(</span><span class="n">configuration</span><span class="p">.</span><span class="n">audience</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">issueTime</span><span class="p">(</span><span class="nc">Date</span><span class="p">())</span>
    <span class="p">.</span><span class="nf">expirationTime</span><span class="p">(</span><span class="n">expiration</span><span class="p">)</span> // <b class="conum">(1)</b>
    <span class="p">.</span><span class="nf">claim</span><span class="p">(</span><span class="s">"email"</span><span class="p">,</span> <span class="n">userInfo</span><span class="p">.</span><span class="n">email</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">claim</span><span class="p">(</span><span class="s">"username"</span><span class="p">,</span> <span class="n">userInfo</span><span class="p">.</span><span class="n">username</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">claim</span><span class="p">(</span><span class="s">"firstName"</span><span class="p">,</span> <span class="n">userInfo</span><span class="p">.</span><span class="n">firstname</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">claim</span><span class="p">(</span><span class="s">"lastName"</span><span class="p">,</span> <span class="n">userInfo</span><span class="p">.</span><span class="n">lastname</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">claim</span><span class="p">(</span><span class="s">"logoutToken"</span><span class="p">,</span> <span class="n">session</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">build</span><span class="p">()</span>
<span class="kd">val</span> <span class="py">signedJWT</span> <span class="p">=</span> <span class="nc">SignedJWT</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>

<span class="n">signedJWT</span><span class="p">.</span><span class="nf">sign</span><span class="p">(</span><span class="n">signer</span><span class="p">)</span>

<span class="kd">val</span> <span class="py">jwt</span><span class="p">:</span> <span class="nc">String</span> <span class="p">=</span> <span class="k">if</span> <span class="p">(</span><span class="n">configuration</span><span class="p">.</span><span class="n">encryption</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Create JWE object with signed JWT as payload</span>
    <span class="kd">val</span> <span class="py">jweHeader</span> <span class="p">=</span> <span class="nc">JWEHeader</span><span class="p">.</span><span class="nc">Builder</span><span class="p">(</span><span class="nc">JWEAlgorithm</span><span class="p">.</span><span class="nc">RSA_OAEP_256</span><span class="p">,</span> <span class="nc">EncryptionMethod</span><span class="p">.</span><span class="nc">A256GCM</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">contentType</span><span class="p">(</span><span class="s">"JWT"</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">build</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">jweObject</span> <span class="p">=</span> <span class="nc">JWEObject</span><span class="p">(</span><span class="n">jweHeader</span><span class="p">,</span> <span class="nc">Payload</span><span class="p">(</span><span class="n">signedJWT</span><span class="p">))</span>
    <span class="c1">// Encrypt with the recipient's public key</span>
    <span class="n">jweObject</span><span class="p">.</span><span class="nf">encrypt</span><span class="p">(</span><span class="n">encrypter</span><span class="p">)</span>
    <span class="n">jweObject</span><span class="p">.</span><span class="nf">serialize</span><span class="p">()</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// Create a signed JWT</span>
    <span class="n">signedJWT</span><span class="p">.</span><span class="nf">serialize</span><span class="p">()</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Unblu will accept the JWT to start a session until the expiration time is in the past.
The session can go on much longer than the JWT expiration.
In production environments, we recommend a JWT expiration of 60 seconds.</p>
<div class="paragraph">
<p>The RSA key pair used to sign the JWT can be static, or an ephemeral key rotated on a regular basis.
Unblu just needs to be able to load a key using JSON Web Key (JWK) at all times.
If you use rotating keys, you should therefore include some grace period during which you serve both the old and the new key in the same JWK key set.</p>
</div>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">Generate RSA key pair to sign JWTs</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="k">private</span> <span class="kd">val</span> <span class="py">key</span><span class="p">:</span> <span class="nc">RSAKey</span> <span class="p">=</span> <span class="nc">RSAKeyGenerator</span><span class="p">(</span><span class="mi">2048</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">keyUse</span><span class="p">(</span><span class="nc">KeyUse</span><span class="p">.</span><span class="nc">SIGNATURE</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">keyID</span><span class="p">(</span><span class="nc">UUID</span><span class="p">.</span><span class="nf">randomUUID</span><span class="p">().</span><span class="nf">toString</span><span class="p">())</span>
    <span class="p">.</span><span class="nf">generate</span><span class="p">()</span>
<span class="k">private</span> <span class="kd">val</span> <span class="py">signer</span> <span class="p">=</span> <span class="nc">RSASSASigner</span><span class="p">(</span><span class="n">key</span><span class="p">.</span><span class="nf">toRSAPrivateKey</span><span class="p">())</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Expose the public key in a JWK set in a Spring Boot application</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">"jwk"</span><span class="p">)</span>
<span class="k">fun</span> <span class="nf">keys</span><span class="p">():</span> <span class="nc">Map</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">,</span> <span class="nc">Any</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nc">JWKSet</span><span class="p">(</span><span class="n">key</span><span class="p">.</span><span class="nf">toPublicJWK</span><span class="p">()).</span><span class="nf">toJSONObject</span><span class="p">()</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example response of the JWK endpoint</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="json"><span class="p">{</span><span class="w">
  </span><span class="nl">"keys"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"kty"</span><span class="p">:</span><span class="w"> </span><span class="s2">"RSA"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"e"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AQAB"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"use"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sig"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"kid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5d2acf7b-b5e3-4a08-8e71-0953f8cdf1f6"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"n"</span><span class="p">:</span><span class="w"> </span><span class="s2">"42"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_starting_an_unblu_authentication_session_using_a_jwt">Starting an Unblu authentication session using a JWT</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Unblu exposes an endpoint to check whether a user is currently authenticated.
We recommend calling this endpoint before starting a new authentication.</p>
</div>
<div class="listingblock">
<div class="title">Check whether a user has a valid session in Unblu</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="cm">/**
  * Calls the authentication verification endpoint of Unblu.
  *
  * @returns {Promise&lt;boolean&gt;} Whether the user is authenticated
  */</span>
<span class="k">async</span> <span class="nf">checkAuthentication </span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span> <span class="na">credentials</span><span class="p">:</span> <span class="dl">'</span><span class="s1">include</span><span class="dl">'</span> <span class="p">};</span> // <b class="conum">(1)</b>
  <span class="k">return</span> <span class="k">await</span> <span class="nf">fetch</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">unbluBaseUrl</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">/rest/v3/authenticator/isAuthenticated</span><span class="dl">'</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">then</span><span class="p">(</span><span class="nx">response</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="s2">`An error has occurred: </span><span class="p">${</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">response</span><span class="p">;</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nf">then</span><span class="p">(</span><span class="nx">response</span> <span class="o">=&gt;</span> <span class="nx">response</span><span class="p">.</span><span class="nf">json</span><span class="p">());</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>All browsers block third-party cookies unless you set <code>credentials: 'include'</code> (<a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API">fetch</a>) or <code>withCredentials = true</code> (<a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest">XMLHttpRequest</a>)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If <code>checkAuthentication()</code> returns <code>false</code>, you can start the authentication process.
After obtaining the signed JWT from the application, the JWT must be sent to Unblu in a POST request to the endpoint <code>unblu/rest/authenticator/loginWithSecureToken</code>.</p>
</div>
<div class="listingblock">
<div class="title">Call <code>loginWithSecureToken</code> from the visitor&#8217;s browser</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="cm">/**
  * Starts an Unblu authentication session using a JWT.
  * @returns {Promise}, fulfilled when login succeeded, rejected when login failed.
  */</span>
<span class="nf">activateUnbluJwt </span><span class="p">(</span><span class="nx">jwt</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">request</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json;charset=UTF-8</span><span class="dl">'</span>
    <span class="p">},</span>
    <span class="na">body</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">stringify</span><span class="p">({</span> <span class="na">token</span><span class="p">:</span> <span class="nx">jwt</span><span class="p">,</span> <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">JWT</span><span class="dl">'</span> <span class="p">}),</span>
    <span class="na">credentials</span><span class="p">:</span> <span class="dl">'</span><span class="s1">include</span><span class="dl">'</span>
  <span class="p">};</span>
  <span class="kd">const</span> <span class="nx">loginUrl</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">unbluBaseUrl</span><span class="p">}</span><span class="s2">/rest/v3/authenticator/loginWithSecureToken?x-unblu-apikey=</span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">unbluApiKey</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
  <span class="k">return</span> <span class="nf">fetch</span><span class="p">(</span><span class="nx">loginUrl</span><span class="p">,</span> <span class="nx">request</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">then</span><span class="p">((</span><span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Unblu session activated</span><span class="dl">'</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Failed to activate token!</span><span class="dl">'</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The response to <code>loginWithSecureToken</code> includes a <code>Set-Cookie</code> header.</p>
</div>
<div class="listingblock">
<div class="title">Example authentication cookie</div>
<div class="content">
<pre class="rouge highlight"><code>Set-Cookie: x-unblu-authsession="4c2sGUuN-6GM8pL9-szYsb8_AQlEM49nJDY~";Path=/unblu;Expires=Wed, 09 Jun 2021 14:41:12 GMT;SameSite=None;Secure;HttpOnly</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Unblu backend and the host application must run on the same second-level domain (e.g. company.com).
Otherwise, some browsers (i.e. Safari and future version of Chrome) will treat the Unblu authentication cookie as a third-party cookie and therefore block it.
To circumvent this issue, create a subdomain such as chat.example.com that points to our cloud IP address.
Your website should then use this subdomain to call Unblu.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ending_an_unblu_session">Ending an Unblu session</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Depending on your risk assessment, you may want to end the Unblu session when the application performs a logout.</p>
</div>
<div class="listingblock">
<div class="title">Call <code>clientLogout</code> from the visitor&#8217;s browser</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="cm">/**
  * Calls the Unblu logout endpoint.
  * @returns {Promise}, fulfilled when logout succeeded, rejected when logout failed.
  */</span>
<span class="nf">clientLogout </span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">request</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json;charset=UTF-8</span><span class="dl">'</span>
    <span class="p">},</span>
    <span class="na">body</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">stringify</span><span class="p">({</span> <span class="na">redirectOnSuccess</span><span class="p">:</span> <span class="kc">null</span> <span class="p">}),</span>
    <span class="na">credentials</span><span class="p">:</span> <span class="dl">'</span><span class="s1">include</span><span class="dl">'</span>
  <span class="p">};</span>
  <span class="kd">const</span> <span class="nx">logoutUrl</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">unbluBaseUrl</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">/rest/v3/authenticator/logout</span><span class="dl">'</span><span class="p">;</span>
  <span class="k">return</span> <span class="nf">fetch</span><span class="p">(</span><span class="nx">logoutUrl</span><span class="p">,</span> <span class="nx">request</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">then</span><span class="p">((</span><span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Unblu logout successful</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">location</span><span class="p">.</span><span class="nf">reload</span><span class="p">();</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Logout failed</span><span class="dl">'</span><span class="p">,</span> <span class="nx">response</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Execute <code>logout</code> from the application backend (server-to-server API call)</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="kotlin"><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">"logout"</span><span class="p">)</span>
<span class="k">fun</span> <span class="nf">logout</span><span class="p">(</span><span class="n">session</span><span class="p">:</span> <span class="nc">WebSession</span><span class="p">)</span> <span class="p">:</span> <span class="nc">String</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">header</span> <span class="p">=</span> <span class="nc">JWSHeader</span><span class="p">.</span><span class="nc">Builder</span><span class="p">(</span><span class="nc">JWSAlgorithm</span><span class="p">.</span><span class="nc">RS256</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">type</span><span class="p">(</span><span class="nc">JOSEObjectType</span><span class="p">.</span><span class="nc">JWT</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">keyID</span><span class="p">(</span><span class="n">key</span><span class="p">.</span><span class="n">keyID</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">build</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">expiration</span> <span class="p">=</span> <span class="nc">Date</span><span class="p">(</span><span class="nc">System</span><span class="p">.</span><span class="nf">currentTimeMillis</span><span class="p">()</span> <span class="p">+</span> <span class="n">configuration</span><span class="p">.</span><span class="n">validFor</span><span class="p">.</span><span class="nf">toMillis</span><span class="p">())</span>
    <span class="kd">val</span> <span class="py">payload</span> <span class="p">=</span> <span class="nc">JWTClaimsSet</span><span class="p">.</span><span class="nc">Builder</span><span class="p">()</span>
        <span class="p">.</span><span class="nf">issuer</span><span class="p">(</span><span class="n">configuration</span><span class="p">.</span><span class="n">issuer</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">audience</span><span class="p">(</span><span class="n">configuration</span><span class="p">.</span><span class="n">audience</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">issueTime</span><span class="p">(</span><span class="nc">Date</span><span class="p">())</span>
        <span class="p">.</span><span class="nf">expirationTime</span><span class="p">(</span><span class="n">expiration</span><span class="p">)</span> // <b class="conum">(1)</b>
        <span class="p">.</span><span class="nf">claim</span><span class="p">(</span><span class="s">"logoutToken"</span><span class="p">,</span> <span class="n">session</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">build</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">signedJWT</span> <span class="p">=</span> <span class="nc">SignedJWT</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>

    <span class="n">signedJWT</span><span class="p">.</span><span class="nf">sign</span><span class="p">(</span><span class="n">signer</span><span class="p">)</span>

    <span class="kd">val</span> <span class="py">jwt</span><span class="p">:</span> <span class="nc">String</span> <span class="p">=</span> <span class="k">if</span> <span class="p">(</span><span class="n">configuration</span><span class="p">.</span><span class="n">encryption</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Create JWE object with signed JWT as payload</span>
        <span class="kd">val</span> <span class="py">jweHeader</span> <span class="p">=</span> <span class="nc">JWEHeader</span><span class="p">.</span><span class="nc">Builder</span><span class="p">(</span><span class="nc">JWEAlgorithm</span><span class="p">.</span><span class="nc">RSA_OAEP_256</span><span class="p">,</span> <span class="nc">EncryptionMethod</span><span class="p">.</span><span class="nc">A256GCM</span><span class="p">)</span>
            <span class="p">.</span><span class="nf">contentType</span><span class="p">(</span><span class="s">"JWT"</span><span class="p">)</span>
            <span class="p">.</span><span class="nf">build</span><span class="p">()</span>
        <span class="kd">val</span> <span class="py">jweObject</span> <span class="p">=</span> <span class="nc">JWEObject</span><span class="p">(</span><span class="n">jweHeader</span><span class="p">,</span> <span class="nc">Payload</span><span class="p">(</span><span class="n">signedJWT</span><span class="p">))</span>
        <span class="c1">// Encrypt with the recipient's public key</span>
        <span class="n">jweObject</span><span class="p">.</span><span class="nf">encrypt</span><span class="p">(</span><span class="n">encrypter</span><span class="p">)</span>
        <span class="n">jweObject</span><span class="p">.</span><span class="nf">serialize</span><span class="p">()</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// Create a signed JWT</span>
        <span class="n">signedJWT</span><span class="p">.</span><span class="nf">serialize</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">val</span> <span class="py">targetURI</span> <span class="p">=</span> <span class="nc">URI</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">unbluConfiguration</span><span class="p">.</span><span class="n">serverUrl</span> <span class="p">+</span> <span class="n">unbluConfiguration</span><span class="p">.</span><span class="n">entryPath</span> <span class="p">+</span> <span class="s">"/rest/v3/authenticator/logoutWithSecureToken?x-unblu-apikey="</span> <span class="p">+</span> <span class="n">unbluConfiguration</span><span class="p">.</span><span class="n">apiKey</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">client</span> <span class="p">=</span> <span class="nc">HttpClient</span><span class="p">.</span><span class="nf">newBuilder</span><span class="p">().</span><span class="nf">build</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">request</span> <span class="p">=</span> <span class="nc">HttpRequest</span><span class="p">.</span><span class="nf">newBuilder</span><span class="p">()</span>
        <span class="p">.</span><span class="nf">uri</span><span class="p">(</span><span class="n">targetURI</span><span class="p">)</span>
        <span class="p">.</span><span class="nc">POST</span><span class="p">(</span><span class="nc">HttpRequest</span><span class="p">.</span><span class="nc">BodyPublishers</span><span class="p">.</span><span class="nf">ofString</span><span class="p">(</span><span class="s">"{\n\"token\":\"$jwt\",\n\"type\":\"JWT\"\n}"</span><span class="p">))</span>
        <span class="p">.</span><span class="nf">header</span><span class="p">(</span><span class="s">"Content-Type"</span><span class="p">,</span> <span class="s">"application/json;charset=UTF-8"</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">build</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">response</span> <span class="p">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="nc">HttpResponse</span><span class="p">.</span><span class="nc">BodyHandlers</span><span class="p">.</span><span class="nf">ofString</span><span class="p">())</span>

    <span class="n">session</span><span class="p">.</span><span class="nf">invalidate</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">response</span><span class="p">.</span><span class="nf">body</span><span class="p">()</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2023-08-11 08:49:54 UTC
</div>
</div>
</body>
</html>